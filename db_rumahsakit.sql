-- Pembuatan Database SQL Rumah Sakit 

DROP DATABASE IF EXISTS `db_rumahsakit`;
CREATE DATABASE `db_rumahsakit`; 
USE `db_rumahsakit`;

DROP TABLE IF EXISTS Dokter;
CREATE TABLE Dokter (
  PegawaiID INTEGER NOT NULL,
  Nama VARCHAR(30) NOT NULL,
  Posisi VARCHAR(30) NOT NULL,
  NoKTP INTEGER NOT NULL,
  CONSTRAINT pk_Dokter PRIMARY KEY(PegawaiID)
); 

DROP TABLE IF EXISTS Unit;
CREATE TABLE Unit (
  UnitID INTEGER NOT NULL,
  Nama VARCHAR(30) NOT NULL,
  Kepala INTEGER NOT NULL,
  CONSTRAINT pk_Unit PRIMARY KEY(UnitID),
  CONSTRAINT fk_Unit_Dokter_PegawaiID FOREIGN KEY(Kepala) REFERENCES Dokter(PegawaiID)
);


DROP TABLE IF EXISTS Afiliasi;
CREATE TABLE Afiliasi (
  Dokter INTEGER NOT NULL,
  Unit INTEGER NOT NULL,
  AfiliasiUtama BOOLEAN NOT NULL,
  CONSTRAINT fk_Afiliasi_Dokter_PegawaiID FOREIGN KEY(Dokter) REFERENCES Dokter(PegawaiID),
  CONSTRAINT fk_Afiliasi_Unit_UnitID FOREIGN KEY(Unit) REFERENCES Unit(UnitID),
  PRIMARY KEY(Dokter, Unit)
);

DROP TABLE IF EXISTS Prosedur;
CREATE TABLE Prosedur (
  Kode INTEGER PRIMARY KEY NOT NULL,
  Nama VARCHAR(30) NOT NULL,
  Biaya REAL NOT NULL
);

DROP TABLE IF EXISTS Kompetensi_Dokter;
CREATE TABLE Kompetensi_Dokter (
  Dokter INTEGER NOT NULL,
  Pengobatan INTEGER NOT NULL,
  TanggalSertifikasi DATETIME NOT NULL,
  SertifikasiKadaluarsa DATETIME NOT NULL,
  CONSTRAINT fk_Kompetensi_Dokter_Dokter_PegawaiID FOREIGN KEY(Dokter) REFERENCES Dokter(PegawaiID),
  CONSTRAINT fk_Kompetensi_Dokter_Prosedur_Kode FOREIGN KEY(Pengobatan) REFERENCES Prosedur(Kode),
  PRIMARY KEY(Dokter, Pengobatan)
);

DROP TABLE IF EXISTS Pasien;
CREATE TABLE Pasien (
  NoKTP INTEGER PRIMARY KEY NOT NULL,
  Nama VARCHAR(30) NOT NULL,
  Alamat VARCHAR(30) NOT NULL,
  NoTelp VARCHAR(30) NOT NULL,
  AsuransiID INTEGER NOT NULL,
  DPJP INTEGER NOT NULL,
  CONSTRAINT fk_Pasien_Dokter_PegawaiID FOREIGN KEY(DPJP) REFERENCES Dokter(PegawaiID)
);

DROP TABLE IF EXISTS Perawat;
CREATE TABLE Perawat (
  PegawaiID INTEGER PRIMARY KEY NOT NULL,
  Nama VARCHAR(30) NOT NULL,
  Posisi VARCHAR(30) NOT NULL,
  Terdaftar BOOLEAN NOT NULL,
  NoKTP INTEGER NOT NULL
);

DROP TABLE IF EXISTS Janji_Temu;
CREATE TABLE Janji_Temu (
  Janji_TemuID INTEGER PRIMARY KEY NOT NULL,
  Pasien INTEGER NOT NULL,    
  Perawat INTEGER,
  Dokter INTEGER NOT NULL,
  Mulai DATETIME NOT NULL,
  Berakhir DATETIME NOT NULL,
  RuangPemeriksaan TEXT NOT NULL,
  CONSTRAINT fk_Janji_Temu_Pasien_NoKTP FOREIGN KEY(Pasien) REFERENCES Pasien(NoKTP),
  CONSTRAINT fk_Janji_Temu_Perawat_PegawaiID FOREIGN KEY(Perawat) REFERENCES Perawat(PegawaiID),
  CONSTRAINT fk_Janji_Temu_Dokter_PegawaiID FOREIGN KEY(Dokter) REFERENCES Dokter(PegawaiID)
);

DROP TABLE IF EXISTS Obat;
CREATE TABLE Obat (
  Kode INTEGER PRIMARY KEY NOT NULL,
  Nama VARCHAR(30) NOT NULL,
  Merek VARCHAR(30) NOT NULL,
  Deskripsi VARCHAR(30) NOT NULL
);

DROP TABLE IF EXISTS Resep;
CREATE TABLE Resep (
  Dokter INTEGER NOT NULL,
  Pasien INTEGER NOT NULL, 
  Obat INTEGER NOT NULL, 
  Date DATETIME NOT NULL,
  Janji_Temu INTEGER,  
  Dosis VARCHAR(30) NOT NULL,
  PRIMARY KEY(Dokter, Pasien, Obat, Date),
  CONSTRAINT fk_Resep_Dokter_PegawaiID FOREIGN KEY(Dokter) REFERENCES Dokter(PegawaiID),
  CONSTRAINT fk_Resep_Pasien_NoKTP FOREIGN KEY(Pasien) REFERENCES Pasien(NoKTP),
  CONSTRAINT fk_Resep_Obat_Kode FOREIGN KEY(Obat) REFERENCES Obat(Kode),
  CONSTRAINT fk_Resep_Janji_Temu_Janji_TemuID FOREIGN KEY(Janji_Temu) REFERENCES Janji_Temu(Janji_TemuID)
);

DROP TABLE IF EXISTS Gedung;
CREATE TABLE Gedung (
  LantaiGedung INTEGER NOT NULL,
  KodeGedung INTEGER NOT NULL,
  PRIMARY KEY(LantaiGedung, KodeGedung)
); 

DROP TABLE IF EXISTS Ruang;
CREATE TABLE Ruang (
  RuangNumber INTEGER PRIMARY KEY NOT NULL,
  RuangType VARCHAR(30) NOT NULL,
  LantaiGedung INTEGER NOT NULL,  
  KodeGedung INTEGER NOT NULL,  
  Tersedia BOOLEAN NOT NULL,
  CONSTRAINT fk_Ruang_Gedung_PK FOREIGN KEY(LantaiGedung, KodeGedung) REFERENCES Gedung(LantaiGedung, KodeGedung)
);

DROP TABLE IF EXISTS On_Call;
CREATE TABLE On_Call (
  Perawat INTEGER NOT NULL,
  LantaiGedung INTEGER NOT NULL, 
  KodeGedung INTEGER NOT NULL,
  OnCallMulai DATETIME NOT NULL,
  OnCallBerakhir DATETIME NOT NULL,
  PRIMARY KEY(Perawat, LantaiGedung, KodeGedung, OnCallMulai, OnCallBerakhir),
  CONSTRAINT fk_OnCall_Perawat_PegawaiID FOREIGN KEY(Perawat) REFERENCES Perawat(PegawaiID),
  CONSTRAINT fk_OnCall_Gedung_Lantai FOREIGN KEY(LantaiGedung, KodeGedung) REFERENCES Gedung(LantaiGedung, KodeGedung) 
);

DROP TABLE IF EXISTS Inap;
CREATE TABLE Inap (
  InapID INTEGER PRIMARY KEY NOT NULL,
  Pasien INTEGER NOT NULL,
  Ruang INTEGER NOT NULL,
  InapMulai DATETIME NOT NULL,
  InapBerakhir DATETIME NOT NULL,
  CONSTRAINT fk_Inap_Pasien_NoKTP FOREIGN KEY(Pasien) REFERENCES Pasien(NoKTP),
  CONSTRAINT fk_Inap_Ruang_Number FOREIGN KEY(Ruang) REFERENCES Ruang(RuangNumber)
);

DROP TABLE IF EXISTS Jaga;
CREATE TABLE Jaga (
  Pasien INTEGER NOT NULL,
  Prosedur INTEGER NOT NULL,
  Inap INTEGER NOT NULL,
  TanggalJaga DATETIME NOT NULL,
  Dokter INTEGER NOT NULL,
  PerawatJaga INTEGER,
  PRIMARY KEY(Pasien, Prosedur, Inap, TanggalJaga),
  CONSTRAINT fk_Jaga_Pasien_NoKTP FOREIGN KEY(Pasien) REFERENCES Pasien(NoKTP),
  CONSTRAINT fk_Jaga_Prosedur_Kode FOREIGN KEY(Prosedur) REFERENCES Prosedur(Kode),
  CONSTRAINT fk_Jaga_Inap_InapID FOREIGN KEY(Inap) REFERENCES Inap(InapID),
  CONSTRAINT fk_Jaga_Dokter_PegawaiID FOREIGN KEY(Dokter) REFERENCES Dokter(PegawaiID),
  CONSTRAINT fk_Jaga_Perawat_PegawaiID FOREIGN KEY(PerawatJaga) REFERENCES Perawat(PegawaiID)
);

INSERT INTO Dokter VALUES(1,'Adi Nugroho','Dokter Sp Bedah Saraf',111111111);
INSERT INTO Dokter VALUES(2,'Samsul Ari','Dokter Umum',222222222);
INSERT INTO Dokter VALUES(3,'Dina Laili','Dokter Sp Bedah',333333333);
INSERT INTO Dokter VALUES(4,'Saiful Ramdani','Dokter Umum Senior',444444444);
INSERT INTO Dokter VALUES(5,'Adi Safrizal','Dokter Bedah Senior',555555555);
INSERT INTO Dokter VALUES(6,'Yani Sukmaningtyas','Dokter Sp Bedah',666666666);
INSERT INTO Dokter VALUES(7,'Stella Kusumayanti','Dokter Sp Bedah',777777777);
INSERT INTO Dokter VALUES(8,'Agus Rizal','Dokter Muda',888888888);
INSERT INTO Dokter VALUES(9,'Dewi Hastuti','Psikiater',999999999);
INSERT INTO Dokter VALUES(10,'Arini Suprapto','Psikiater',111111119);

INSERT INTO Unit VALUES(1,'Umum',4);
INSERT INTO Unit VALUES(2,'Bedah',7);
INSERT INTO Unit VALUES(3,'Psikiater',9);

INSERT INTO Afiliasi VALUES(1,1,1);
INSERT INTO Afiliasi VALUES(2,1,1);
INSERT INTO Afiliasi VALUES(3,1,0);
INSERT INTO Afiliasi VALUES(3,2,1);
INSERT INTO Afiliasi VALUES(4,1,1);
INSERT INTO Afiliasi VALUES(5,1,1);
INSERT INTO Afiliasi VALUES(6,2,1);
INSERT INTO Afiliasi VALUES(7,1,0);
INSERT INTO Afiliasi VALUES(7,2,1);
INSERT INTO Afiliasi VALUES(8,1,1);
INSERT INTO Afiliasi VALUES(9,3,1);

INSERT INTO Prosedur VALUES(1,'Reverse Hysterectomy',1500000.0);
INSERT INTO Prosedur VALUES(2,'Carotid endarterectomy',3750000.0);
INSERT INTO Prosedur VALUES(3,'Folded Demiophtalmectomy',4500000.0);
INSERT INTO Prosedur VALUES(4,'Complete Cholecystectomy',10000000.0);
INSERT INTO Prosedur VALUES(5,'Coronary artery bypass',4899000.0);
INSERT INTO Prosedur VALUES(6,'Reversible Prostatectomy',5600000.0);
INSERT INTO Prosedur VALUES(7,'Follicular Tonsillectomy',25000.0);

INSERT INTO Pasien VALUES(100000001,'Sebastian Susanto','Jl. Anggrek no 15','555-0256',68476213,1);
INSERT INTO Pasien VALUES(100000002,'Hamidah Goenawan','Jl. Mawar no 12','555-0512',36546321,2);
INSERT INTO Pasien VALUES(100000003,'Harry Sabirin','Jl. Melati no 11','555-1204',65465421,2);
INSERT INTO Pasien VALUES(100000004,'Yuliana Meita','Jl. Jeruk no 10','555-2048',68421879,3);
INSERT INTO Pasien VALUES(100000005,'Sukma Aini','Jl. Anggur no 70B','555-2148',68476878,3);
INSERT INTO Pasien VALUES(100000006,'Ari Aldianto','Jl. Apel no 22A','555-2049',68422273,4);

INSERT INTO Perawat VALUES(101,'Sherly Indarto','Kepala Perawat',1,111111110);
INSERT INTO Perawat VALUES(102,'Maria Wijaya','Perawat',1,222222220);
INSERT INTO Perawat VALUES(103,'Devi Apriliana','Perawat',0,333333330);
INSERT INTO Perawat VALUES(104,'Sinta Agustin','Perawat',0,444444440);
INSERT INTO Perawat VALUES(105,'Susan Andini','Perawat',1,555555550);

INSERT INTO Janji_Temu VALUES(13216584,100000001,101,1,'2019-04-24 10:00','2019-04-24 11:00','A');
INSERT INTO Janji_Temu VALUES(26548913,100000002,101,2,'2019-04-24 10:00','2019-04-24 11:00','B');
INSERT INTO Janji_Temu VALUES(36549879,100000001,102,1,'2019-04-25 10:00','2019-04-25 11:00','A');
INSERT INTO Janji_Temu VALUES(46846589,100000004,103,4,'2019-04-25 10:00','2019-04-25 11:00','B');
INSERT INTO Janji_Temu VALUES(59871321,100000004,NULL,4,'2019-04-26 10:00','2019-04-26 11:00','C');
INSERT INTO Janji_Temu VALUES(69879231,100000003,103,2,'2019-04-26 11:00','2019-04-26 12:00','C');
INSERT INTO Janji_Temu VALUES(76983231,100000001,NULL,3,'2019-04-26 12:00','2019-04-26 13:00','C');
INSERT INTO Janji_Temu VALUES(86213939,100000004,102,9,'2019-04-27 10:00','2019-04-21 11:00','A');
INSERT INTO Janji_Temu VALUES(93216548,100000002,101,2,'2019-04-27 10:00','2019-04-27 11:00','B');

INSERT INTO Obat VALUES(1,'Procrastin-X','X','N/A');
INSERT INTO Obat VALUES(2,'Thesisin','Kalb Laboratorium','N/A');
INSERT INTO Obat VALUES(3,'Awakin','Infi Farma','N/A');
INSERT INTO Obat VALUES(4,'Crescavitin','Kimia Industries','N/A');
INSERT INTO Obat VALUES(5,'Dexamatason','Sehat Pharmaceuticals','N/A');
INSERT INTO Obat VALUES(6,'Ibuprofen','Farmasi Sejahtera','N/A');

INSERT INTO Resep VALUES(1,100000001,1,'2019-04-24 10:47',13216584,'5');
INSERT INTO Resep VALUES(9,100000004,2,'2019-04-27 10:53',86213939,'10');
INSERT INTO Resep VALUES(9,100000004,2,'2019-04-30 16:53',NULL,'5');

INSERT INTO Gedung VALUES(1,1);
INSERT INTO Gedung VALUES(1,2);
INSERT INTO Gedung VALUES(1,3);
INSERT INTO Gedung VALUES(2,1);
INSERT INTO Gedung VALUES(2,2);
INSERT INTO Gedung VALUES(2,3);
INSERT INTO Gedung VALUES(3,1);
INSERT INTO Gedung VALUES(3,2);
INSERT INTO Gedung VALUES(3,3);
INSERT INTO Gedung VALUES(4,1);
INSERT INTO Gedung VALUES(4,2);
INSERT INTO Gedung VALUES(4,3);

INSERT INTO Ruang VALUES(101,'Single',1,1,1);
INSERT INTO Ruang VALUES(102,'Single',1,1,1);
INSERT INTO Ruang VALUES(103,'Single',1,1,1);
INSERT INTO Ruang VALUES(111,'Single',1,2,1);
INSERT INTO Ruang VALUES(112,'Single',1,2,0);
INSERT INTO Ruang VALUES(113,'Single',1,2,1);
INSERT INTO Ruang VALUES(121,'Single',1,3,1);
INSERT INTO Ruang VALUES(122,'Single',1,3,1);
INSERT INTO Ruang VALUES(123,'Single',1,3,1);
INSERT INTO Ruang VALUES(201,'Single',2,1,0);
INSERT INTO Ruang VALUES(202,'Single',2,1,1);
INSERT INTO Ruang VALUES(203,'Single',2,1,1);
INSERT INTO Ruang VALUES(211,'Single',2,2,1);
INSERT INTO Ruang VALUES(212,'Single',2,2,1);
INSERT INTO Ruang VALUES(213,'Single',2,2,0);
INSERT INTO Ruang VALUES(221,'Single',2,3,1);
INSERT INTO Ruang VALUES(222,'Single',2,3,1);
INSERT INTO Ruang VALUES(223,'Single',2,3,1);
INSERT INTO Ruang VALUES(301,'Single',3,1,1);
INSERT INTO Ruang VALUES(302,'Single',3,1,0);
INSERT INTO Ruang VALUES(303,'Single',3,1,1);
INSERT INTO Ruang VALUES(311,'Single',3,2,1);
INSERT INTO Ruang VALUES(312,'Single',3,2,1);
INSERT INTO Ruang VALUES(313,'Single',3,2,1);
INSERT INTO Ruang VALUES(321,'Single',3,3,0);
INSERT INTO Ruang VALUES(322,'Single',3,3,1);
INSERT INTO Ruang VALUES(323,'Single',3,3,1);
INSERT INTO Ruang VALUES(401,'Single',4,1,1);
INSERT INTO Ruang VALUES(402,'Single',4,1,0);
INSERT INTO Ruang VALUES(403,'Single',4,1,1);
INSERT INTO Ruang VALUES(411,'Single',4,2,1);
INSERT INTO Ruang VALUES(412,'Single',4,2,1);
INSERT INTO Ruang VALUES(413,'Single',4,2,1);
INSERT INTO Ruang VALUES(421,'Single',4,3,0);
INSERT INTO Ruang VALUES(422,'Single',4,3,1);
INSERT INTO Ruang VALUES(423,'Single',4,3,1);

INSERT INTO On_Call VALUES(101,1,1,'2019-11-04 11:00','2019-11-04 19:00');
INSERT INTO On_Call VALUES(101,1,2,'2019-11-04 11:00','2019-11-04 19:00');
INSERT INTO On_Call VALUES(102,1,3,'2019-11-04 11:00','2019-11-04 19:00');
INSERT INTO On_Call VALUES(103,1,1,'2019-11-04 19:00','2019-11-05 03:00');
INSERT INTO On_Call VALUES(103,1,2,'2019-11-04 19:00','2019-11-05 03:00');
INSERT INTO On_Call VALUES(103,1,3,'2019-11-04 19:00','2019-11-05 03:00');

INSERT INTO Inap VALUES(3215,100000001,111,'2019-05-01','2019-05-04');
INSERT INTO Inap VALUES(3216,100000003,123,'2019-05-03','2019-05-14');
INSERT INTO Inap VALUES(3217,100000004,112,'2019-05-02','2019-05-03');

INSERT INTO Jaga VALUES(100000001,6,3215,'2019-05-02',3,101);
INSERT INTO Jaga VALUES(100000001,2,3215,'2019-05-03',7,101);
INSERT INTO Jaga VALUES(100000004,1,3217,'2019-05-07',3,102);
INSERT INTO Jaga VALUES(100000004,5,3217,'2019-05-09',6,NULL);
INSERT INTO Jaga VALUES(100000001,7,3217,'2019-05-10',7,101);
INSERT INTO Jaga VALUES(100000004,4,3217,'2019-05-13',3,103);

INSERT INTO Kompetensi_Dokter VALUES(3,1,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(3,2,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(3,5,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(3,6,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(3,7,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(6,2,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(6,5,'2018-01-01','2018-12-31');
INSERT INTO Kompetensi_Dokter VALUES(6,6,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(7,1,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(7,2,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(7,3,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(7,4,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(7,5,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(7,6,'2019-01-01','2019-12-31');
INSERT INTO Kompetensi_Dokter VALUES(7,7,'2019-01-01','2019-12-31');
